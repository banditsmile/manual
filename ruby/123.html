<html><HEAD><TITLE>Programming Ruby: The Pragmatic Programmer's Guide</TITLE>
<META http-equiv=Content-Type content="text/html; charset=iso-8859-1"><LINK media=screen href="123_files/pr_style[1].css"  type=text/css rel=StyleSheet></head>
<BODY bgColor=white>
<TABLE cellSpacing=0 cellPadding=3 width="100%" bgColor=#c09090 border=0>
<TBODY>
<TR>
<TD colSpan=3>
<TABLE cellPadding=20 width="100%" bgColor=#701a1a>
<TBODY>
<TR>
<TD width=6>
<H1 class=header>Programming Ruby</H1>
<H3 class=subheader>The Pragmatic Programmer's Guide</H3></TD></TR></TBODY></TABLE></TD></TR>
<TR>
<TD align=left width="33%"><A class=subheader href="122.html" >Previous &lt;</A> </TD>
<TD vAlign=center align=middle width="33%"><A class=subheader href="95.html" >Contents ^</A> <BR></TD>
<TD align=right width="33%"><A class=subheader href="124.html" >Next &gt;</A> <BR></TD></TR></TBODY></TABLE><!--
Copyright (c) 2001 by Addison Wesley Longman, Inc. This material may
be distributed only subject to the terms and conditions set forth in
the Open Publication License, v1.0 or later (the latest version is
presently available at http://www.opencontent.org/openpub/).
<P></P>
Distribution of substantively modified versions of this document is
prohibited without the explicit permission of the copyright holder.
<P></P>
Distribution of the work or derivative of the work in any standard
(paper) book form is prohibited unless prior permission is obtained
from the copyright holder.
-->
<H1>Microsoft Windows Support</H1>
<HR>
<BR>
<P></P>The three libraries documented in this chapter turn Ruby into a powerful and convenient Windows scripting language. Now you have the power to control your applications, but in a controlled, object-oriented environment. 
<P></P>
<TABLE>
<TBODY>
<TR>
<TD height=20><IMG height=20 src="120_files/dot[1].gif"  width=1></TD></TR></TBODY></TABLE>
<TABLE cellPadding=10 width="100%" bgColor=#660066 border=0>
<TBODY>
<TR>
<TD vAlign=center><FONT color=white size=7>class WIN32OLE</FONT> </TD>
<TD>
<TABLE border=0>
<TBODY>
<TR>
<TD><FONT color=white>Parent: </FONT></TD>
<TD><FONT color=white>Object</FONT> </TD></TR>
<TR>
<TD><FONT color=white>Version: </FONT></TD>
<TD><FONT color=white>1.6 </FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<P></P>
<H3>Index:</H3><A href="123.html#WIN32OLE.connect">connect</A> <A href="123.html#WIN32OLE.const_load">const_load</A> <A href="123.html#WIN32OLE.new">new</A> <I><A href="123.html#WIN32OLE._ob_cb">[ ]</A> </I><I><A href="123.html#WIN32OLE._ob_cb_eq">[ ]=</A> </I><I><A href="123.html#WIN32OLE.each">each</A> </I><I><A href="123.html#WIN32OLE.invoke">invoke</A> </I>
<P></P>
<HR>

<P></P>
<TABLE class=codebox cellSpacing=0 cellPadding=3 width=400 border=0>
<TBODY>
<TR>
<TD><PRE>require&nbsp;'win32ole'
ie&nbsp;=&nbsp;WIN32OLE.new('InternetExplorer.Application')
ie.visible&nbsp;=&nbsp;true
ie.gohome
</PRE></TD></TR></TBODY></TABLE>
<P></P><CODE>WIN32OLE</CODE> provides a client interface to Windows 32 OLE Automation servers. See the tutorial description on page 164 for more information. 
<P></P>
<TABLE cellPadding=10 width="100%" border=0>
<TBODY>
<TR>
<TD vAlign=center bgColor=#990066 colSpan=3><FONT color=white size=6>constants </FONT></TD></TR></TBODY></TABLE>
<TABLE cellPadding=5 border=2>
<TBODY>
<TR>
<TD vAlign=top>
<TR>
<TD><A name=WIN32OLE.WIN32OLE::VERSION><CODE>WIN32OLE::VERSION</CODE> </A></TD>
<TD></TD>
<TD><EM>Current version number</EM> </TD></TR></TD></TR></TBODY></TABLE>
<P></P>
<P></P>
<TABLE cellPadding=10 width="100%" border=0>
<TBODY>
<TR>
<TD vAlign=center bgColor=#990066 colSpan=2><FONT color=white size=6>class methods </FONT></TD></TR>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE.connect>connect</A> </B></FONT></TD>
<TD bgColor=#ffaaaa>WIN32OLE.connect( <I>aString</I> ) -&gt; <I>wapi</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Returns a new OLE automation client connected to an existing instance of the named automation server. 
<P></P></TD>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE.const_load>const_load</A> </B></FONT></TD>
<TD bgColor=#ffaaaa>WIN32OLE.const_load( <I>wapi</I>, <I>[</I> <I>aClass=WIN32OLE</I> <I>]</I> ) -&gt; <CODE>nil</CODE> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Defines the constants from the specified automation server as class constants in <I>aClass</I>. 
<P></P></TD>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE.new>new</A> </B></FONT></TD>
<TD bgColor=#ffaaaa>WIN32OLE.new( <I>aString</I> ) -&gt; <I>wapi</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Returns a new OLE automation client connected to a new instance of the automation server named by <I>aString</I>. 
<P></P></TD></TR></TBODY></TABLE>
<P></P>
<TABLE cellPadding=10 width="100%" border=0>
<TBODY>
<TR>
<TD vAlign=center bgColor=#990066 colSpan=2><FONT color=white size=6>instance methods </FONT></TD></TR>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE._ob_cb>[ ]</A> </B></FONT></TD>
<TD bgColor=#ffaaaa><I>wapi</I>[ <I>aString</I> ] -&gt; <I>anObject</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Returns the named property from the OLE automation object. 
<P></P></TD>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE._ob_cb_eq>[ ]=</A> </B></FONT></TD>
<TD bgColor=#ffaaaa><I>wapi</I>[ <I>aString</I> ] = <I>aValue</I> -&gt; <CODE>nil</CODE> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Sets the named property in the OLE automation object. 
<P></P></TD>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE.each>each</A> </B></FONT></TD>
<TD bgColor=#ffaaaa><I>wapi</I>.each {| anObj | block } 
<P></P>-&gt; <CODE>nil</CODE> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Iterates over each item of this OLE server that supports the <CODE>IEnumVARIANT</CODE> interface. 
<P></P></TD>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE.invoke>invoke</A> </B></FONT></TD>
<TD bgColor=#ffaaaa><I>wapi</I>.invoke ( <I>aCmdString</I>, <I>[</I> <I>args</I> <I>]<SUP>*</SUP> </I>) -&gt; <I>anObject</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Invokes the command given in <I>aCmdString</I> with the given <I>args</I>. <I>args</I> may be a <CODE>Hash</CODE> of named parameters and values. You don't need to call <CODE>invoke</CODE> explicitly; this class uses <CODE>method_missing</CODE> to forward calls through <CODE>invoke</CODE>, so you can simply use the OLE methods as methods of this class. 
<P></P></TD></TR></TBODY></TABLE>
<P></P>
<P></P>
<TABLE>
<TBODY>
<TR>
<TD height=20><IMG height=20 src="120_files/dot[1].gif"  width=1></TD></TR></TBODY></TABLE>
<TABLE cellPadding=10 width="100%" bgColor=#660066 border=0>
<TBODY>
<TR>
<TD vAlign=center><FONT color=white size=7>class WIN32OLE_EVENT</FONT> </TD>
<TD>
<TABLE border=0>
<TBODY>
<TR>
<TD><FONT color=white>Parent: </FONT></TD>
<TD><FONT color=white>Object</FONT> </TD></TR>
<TR>
<TD><FONT color=white>Version: </FONT></TD>
<TD><FONT color=white>1.6 </FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<P></P>
<H3>Index:</H3><A href="123.html#WIN32OLE_EVENT.message_loop">message_loop</A> <A href="123.html#WIN32OLE_EVENT.new">new</A> <I><A href="123.html#WIN32OLE_EVENT.on_event">on_event</A> </I>
<P></P>
<HR>

<P></P>This (slightly modified) example from the Win32OLE 0.1.1 distribution shows the use of an event sink. 
<P></P>
<TABLE class=codebox cellSpacing=0 cellPadding=3 width=400 border=0>
<TBODY>
<TR>
<TD><PRE>require&nbsp;'win32ole'
<P></P>
$urls&nbsp;=&nbsp;[]
<P></P>
def&nbsp;navigate(url)
&nbsp;&nbsp;$urls&nbsp;&lt;&lt;&nbsp;url
end
<P></P>
def&nbsp;stop_msg_loop
&nbsp;&nbsp;puts&nbsp;"IE&nbsp;has&nbsp;exited..."
&nbsp;&nbsp;throw&nbsp;:done
end
<P></P>
def&nbsp;default_handler(event,&nbsp;*args)
&nbsp;&nbsp;case&nbsp;event
&nbsp;&nbsp;when&nbsp;"BeforeNavigate"
&nbsp;&nbsp;&nbsp;&nbsp;puts&nbsp;"Now&nbsp;Navigating&nbsp;to&nbsp;#{args[0]}..."
&nbsp;&nbsp;end
end
<P></P>
ie&nbsp;=&nbsp;WIN32OLE.new('InternetExplorer.Application')
ie.visible&nbsp;=&nbsp;TRUE
ie.gohome
ev&nbsp;=&nbsp;WIN32OLE_EVENT.new(ie,&nbsp;'DWebBrowserEvents')
<P></P>
ev.on_event&nbsp;{|*args|&nbsp;default_handler(*args)}
ev.on_event("NavigateComplete")&nbsp;{|url|&nbsp;navigate(url)}
ev.on_event("Quit")&nbsp;{|*args|&nbsp;stop_msg_loop}
<P></P>
catch(:done)&nbsp;{
&nbsp;&nbsp;loop&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;WIN32OLE_EVENT.message_loop
&nbsp;&nbsp;}
}
<P></P>
puts&nbsp;"You&nbsp;Navigated&nbsp;to&nbsp;the&nbsp;following&nbsp;URLs:&nbsp;"
$urls.each_with_index&nbsp;do&nbsp;|url,&nbsp;i|
&nbsp;&nbsp;puts&nbsp;"(#{i+1})&nbsp;#{url}"
end
</PRE></TD></TR></TBODY></TABLE>
<P></P><CODE>WIN32OLE_EVENT</CODE> is used in conjunction with the <CODE>WIN32OLE</CODE> class to add callbacks for Windows 32 events. 
<TABLE cellPadding=10 width="100%" border=0>
<TBODY>
<TR>
<TD vAlign=center bgColor=#990066 colSpan=2><FONT color=white size=6>class methods </FONT></TD></TR>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE_EVENT.message_loop>message_loop</A> </B></FONT></TD>
<TD bgColor=#ffaaaa>WIN32OLE_EVENT.message_loop -&gt; <CODE>nil</CODE> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Executes the Windows event loop, translating and dispatching events. 
<P></P></TD>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE_EVENT.new>new</A> </B></FONT></TD>
<TD bgColor=#ffaaaa>WIN32OLE_EVENT.new ( <I>anOle</I>, <I>aName</I> ) -&gt; <I>wapi</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Returns a new <CODE>WIN32OLE_EVENT</CODE> (an event sink) for the given <CODE>WIN32OLE</CODE> object and named event source. If <I>aName</I> is <CODE>nil</CODE>, it will attempt to use the default source and will raise a <CODE>RuntimeError</CODE> if it cannot find one. 
<P></P></TD></TR></TBODY></TABLE>
<P></P>
<TABLE cellPadding=10 width="100%" border=0>
<TBODY>
<TR>
<TD vAlign=center bgColor=#990066 colSpan=2><FONT color=white size=6>instance methods </FONT></TD></TR>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=WIN32OLE_EVENT.on_event>on_event</A> </B></FONT></TD>
<TD bgColor=#ffaaaa><I>wapi</I>.on_event ( <I>[</I> <I>anEvent</I> <I>]</I> ) {| args | block } 
<P></P>-&gt; <CODE>nil</CODE> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Defines a callback for the named <I>anEvent</I>. If <I>anEvent</I> is <CODE>nil</CODE>, then this callback is associated with all events. The block will be given any arguments appropriate for this event. 
<P></P></TD></TR></TBODY></TABLE>
<P></P>
<P></P>
<TABLE>
<TBODY>
<TR>
<TD height=20><IMG height=20 src="120_files/dot[1].gif"  width=1></TD></TR></TBODY></TABLE>
<TABLE cellPadding=10 width="100%" bgColor=#660066 border=0>
<TBODY>
<TR>
<TD vAlign=center><FONT color=white size=7>class Win32API</FONT> </TD>
<TD>
<TABLE border=0>
<TBODY>
<TR>
<TD><FONT color=white>Parent: </FONT></TD>
<TD><FONT color=white>Object</FONT> </TD></TR>
<TR>
<TD><FONT color=white>Version: </FONT></TD>
<TD><FONT color=white>1.6 </FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<P></P>
<H3>Index:</H3><A href="123.html#Win32API.new">new</A> <I><A href="123.html#Win32API.call">call</A> </I><I><A href="123.html#Win32API.Call">Call</A> </I>
<P></P>
<HR>

<P></P>This example is from the Ruby distribution, in <CODE>ext/Win32API</CODE>: 
<P></P>
<TABLE class=codebox cellSpacing=0 cellPadding=3 width=400 border=0>
<TBODY>
<TR>
<TD><PRE>require&nbsp;'Win32API'
<P></P>
getCursorPos&nbsp;=&nbsp;Win32API.new("user32",&nbsp;"GetCursorPos",&nbsp;['P'],&nbsp;'V')
<P></P>
lpPoint&nbsp;=&nbsp;"&nbsp;"&nbsp;*&nbsp;8&nbsp;#&nbsp;store&nbsp;two&nbsp;LONGs
getCursorPos.Call(lpPoint)
x,&nbsp;y&nbsp;=&nbsp;lpPoint.unpack("LL")&nbsp;#&nbsp;get&nbsp;the&nbsp;actual&nbsp;values
<P></P>
print&nbsp;"x:&nbsp;",&nbsp;x,&nbsp;"\n"
print&nbsp;"y:&nbsp;",&nbsp;y,&nbsp;"\n"
<P></P>
ods&nbsp;=&nbsp;Win32API.new("kernel32",&nbsp;"OutputDebugString",&nbsp;['P'],&nbsp;'V')
ods.Call("Hello,&nbsp;World\n")
<P></P>
GetDesktopWindow&nbsp;=&nbsp;Win32API.new("user32",&nbsp;"GetDesktopWindow",&nbsp;[],&nbsp;'L')
GetActiveWindow&nbsp;=&nbsp;Win32API.new("user32",&nbsp;"GetActiveWindow",&nbsp;[],&nbsp;'L')
SendMessage&nbsp;=&nbsp;Win32API.new("user32",&nbsp;"SendMessage",&nbsp;['L']&nbsp;*&nbsp;4,&nbsp;'L')
SendMessage.Call(GetDesktopWindow.Call,&nbsp;274,&nbsp;0xf140,&nbsp;0)
</PRE></TD></TR></TBODY></TABLE>
<P></P>The <CODE>Win32API</CODE> module allows access to any arbitrary Windows 32 function. Many of these functions take or return a <CODE>Pointer</CODE> datatype---a region of memory corresponding to a C string or structure type. 
<P></P>In Ruby, these pointers are represented using class <CODE>String</CODE>, which contains a sequence of 8-bit bytes. It is up to you to pack and unpack the bits in the <CODE>String</CODE>. See the reference section for unpack on page 378 and pack on page 286 for details. 
<TABLE cellPadding=10 width="100%" border=0>
<TBODY>
<TR>
<TD vAlign=center bgColor=#990066 colSpan=2><FONT color=white size=6>class methods </FONT></TD></TR>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=Win32API.new>new</A> </B></FONT></TD>
<TD bgColor=#ffaaaa>Win32API.new( <I>dllname</I>, <I>procname</I>, <I>importArray</I>, <I>export</I> ) -&gt; <I>wapi</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Returns a new object representing a Windows 32 API function. <I>dllname</I> is the name of the DLL containing the function, such as ``user32'' or ``kernel32.'' <I>procname</I> is the name of the desired function. <I>importArray</I> is an array of strings representing the types of arguments to the function. <I>export</I> is a string representing the return type of the function. Strings ``n'' and ``l'' represent numbers, ``i'' represent integers, ``p'' represents pointers to data stored in a string, and ``v'' represents a void type (used for export parameters only). These strings are case-insensitive. 
<P></P></TD></TR></TBODY></TABLE>
<P></P>
<TABLE cellPadding=10 width="100%" border=0>
<TBODY>
<TR>
<TD vAlign=center bgColor=#990066 colSpan=2><FONT color=white size=6>instance methods </FONT></TD></TR>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=Win32API.call>call</A> </B></FONT></TD>
<TD bgColor=#ffaaaa><I>wapi</I>.call( <I>[</I> <I>args</I> <I>]<SUP>*</SUP> </I>) -&gt; <I>anObject</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Calls this API function with the given arguments, which must match the signature specified to <CODE>new</CODE>. 
<P></P></TD>
<TR>
<TD vAlign=center bgColor=#ff9999><FONT size=4><B><A name=Win32API.Call>Call</A> </B></FONT></TD>
<TD bgColor=#ffaaaa><I>wapi</I>.Call( <I>[</I> <I>args</I> <I>]<SUP>*</SUP> </I>) -&gt; <I>anObject</I> </TD></TR>
<TR>
<TD></TD>
<TD>
<P></P>Synonym for <CODE>Win32API#call</CODE>. 
<P></P></TD></TR></TBODY></TABLE>
<P></P>
<P></P>
<P></P>
<HR>

<TABLE cellSpacing=0 cellPadding=10 bgColor=#a03030 border=0>
<TBODY>
<TR>
<TD align=left width="33%"><A class=subheader href="122.html" >Previous &lt;</A> </TD>
<TD vAlign=center align=middle width="33%"><A class=subheader href="95.html" >Contents ^</A> <BR></TD>
<TD align=right width="33%"><A class=subheader href="124.html" >Next &gt;</A> <BR></TD></TR></TBODY></TABLE>
<P></P><FONT size=-1>Extracted from the book "Programming Ruby - The Pragmatic Programmer's Guide"</FONT> <BR><FONT size=-3>Copyright © 2001 by Addison Wesley Longman, Inc. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v1.0 or later (the latest version is presently available at <A href="http://www.opencontent.org/openpub/" >http://www.opencontent.org/openpub/</A>)). 
<P></P>Distribution of substantively modified versions of this document is prohibited without the explicit permission of the copyright holder. 
<P></P>Distribution of the work or derivative of the work in any standard (paper) book form is prohibited unless prior permission is obtained from the copyright holder. <BR></FONT></BODY>
<!DOCTYPE html>
    <!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
    <!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <title>Javascript Object Notation (JSON)</title> 
        <link rel="shortcut icon" href="../../../static_star_theme/img/favicon.ico"/>
        <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,700italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="../../../static_star_theme/css/theme.css" type="text/css" /> 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
    </head>

    <body class="wy-body-for-nav" role="document">

    <div class="wy-grid-for-nav">

        <div class="wy-full-navbar" data-swiftype-index="false">
            <a href="http://www.memsql.com" class="logo">
                <img src="../../../static_star_theme/img/memsql_logo_horizontal_white.svg" />
            </a>
            <div class="global nav">
                <div class="pull-left left-links">
                </div>
                <div class="pull-right right-links">
                    <a href="http://www.memsql.com/community/" style="word-spacing: 2px;">Community Edition</a>
                    <a href="http://blog.memsql.com">Blog</a>
                    <a href="http://www.memsql.com/memsql-partners">Partners</a>
                    <a href="http://www.memsql.com/resources">Resources</a>
                    <a href="../../../index.html">Documentation</a>
                    <a href="http://www.memsql.com/contact">Contact</a>
                </div>
            </div>
            <div class="nav-links">
                <a href="http://www.memsql.com/product">Product</a>
                <a href="http://www.memsql.com/solutions">Solutions</a>
                <a href="http://www.memsql.com/case-studies">Case Studies</a>
                <a href="http://www.memsql.com/company">Company</a>
                <a class="download" href="http://www.memsql.com/download/">Download Now</a>
            </div>
        </div>

        <nav data-toggle="wy-nav-shift" class="wy-nav-side" data-swiftype-index="false">
            <div class="wy-side-nav-search">
                <div role="search">
  <form id="search-form" class="wy-form" method="get">
    <input type="text" id="st-search-input" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
            </div>

            <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                
                 <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">MemSQL Docs Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">How MemSQL Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup/quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup/get_started/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../concepts/index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../concepts/connecting/index.html">How to Connect to MemSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/how_to_run_queries/index.html">How to Run Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/multi_insert_examples/index.html">Concurrent Multi-Insert Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/data_loading/index.html">Loading Data Into MemSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/porting-apps/index.html">How to Port Your Applications to MemSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/memory_management/index.html">Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/distributed_architecture/index.html">Distributed Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/codegen/index.html">Code Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/key_concepts/index.html">Database Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/distributed_sql/index.html">Distributed SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/columnar/index.html">Column Store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts/geospatial/index.html">Geospatial Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="index.html">Javascript Object Notation (JSON)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="index.html#about-json-in-memsql">About JSON in MemSQL</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#ddl-defining-tables-with-json-columns">DDL: Defining Tables with JSON Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#dml-accessing-data-in-json-columns">DML: Accessing Data in JSON Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#implementation-considerations">Implementation Considerations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/index.html">Operations Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref/commands_by_type/index.html">SQL Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/config/index.html">Configuration Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ops/index.html">MemSQL Ops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../loader/index.html">MemSQL Loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../archive/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../editions/index.html">MemSQL Editions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Frequently Asked Questions</a></li>
</ul>
 
            </div>
            &nbsp;
        </nav>

        <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
            <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
                <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
                <a href="../../../index.html" class="logo">
                    <img src="../../../static_star_theme/img/memsql_logo_horizontal_white.svg" />
                    <span class="subtitle">Documentation</span>
                </a>
            </nav>

            <div class="wy-nav-content">
                <div class="rst-content">
                    <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">MemSQL Documentation</a> &raquo;</li>
      
          <li><a href="../../concepts/index.html">User Manual</a> &raquo;</li>
      
    <li>Javascript Object Notation (JSON)</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
                    <div role="main" class="document">
                        
  <div class="section" id="javascript-object-notation-json">
<span id="json-reference"></span><h1>Javascript Object Notation (JSON)<a class="headerlink" href="index.html#javascript-object-notation-json" title="Permalink to this headline">¶</a></h1>
<p>This topic describes MemSQL&#8217;s support for JavaScript Object Notation (JSON) columns in MemSQL tables. It includes the following sections:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#json-about"><em>About JSON in MemSQL</em></a></li>
<li><a class="reference internal" href="index.html#json-defining"><em>DDL: Defining Tables with JSON Columns</em></a></li>
<li><a class="reference internal" href="index.html#accessing"><em>DML: Accessing Data in JSON Columns</em></a></li>
<li><a class="reference internal" href="index.html#considerations"><em>Implementation Considerations</em></a></li>
</ul>
<div class="section" id="about-json-in-memsql">
<span id="json-about"></span><h2>About JSON in MemSQL<a class="headerlink" href="index.html#about-json-in-memsql" title="Permalink to this headline">¶</a></h2>
<p>MemSQL exposes a JSON column-type that implements the JSON standard. You can define columns in MemSQL tables as the JSON data type in order to efficiently store and query JSON values. A JSON value is a JavaScript object, which means it is represented as a series of name/value pairs that are written according to a structured format and sequence. For more information, see <a class="reference external" href="http://www.ietf.org/rfc/rfc4627.txt">http://www.ietf.org/rfc/rfc4627.txt</a>.</p>
<div class="section" id="managing-collections-of-metadata">
<h3>Managing Collections of Metadata<a class="headerlink" href="index.html#managing-collections-of-metadata" title="Permalink to this headline">¶</a></h3>
<p>JSON is useful for managing a collection of diverse data, represented as name-value pairs, that might otherwise be cumbersome to refactor into a formalized key-value table, or that might be stored in a table that is sparsely populated. For example, suppose an organization had an asset management application using MemSQL to track all the information about its physical assets. The asset data is diverse&#8212;what&#8217;s relevant for a desk differs from what&#8217;s important for a server machine or a company car. All assets might have common attributes, such as asset tag ID, asset type, asset name, and description. Each type of asset might have unique attributes, such as size and weight dimensions, hostname and IP address, or gas mileage.</p>
<p>Instead of creating a highly granular table to manage all data as key-value pairs, this organization could simply create a MemSQL table using a JSON column to efficiently manage the unique attribute data. With this design:</p>
<ul class="simple">
<li>Each asset gets a row in the table.</li>
<li>Attributes that are common to all assets have their own column in the table. These columns allow you to query on common features and quickly narrow down the final result set as much as possible (for example, filtering by asset type).</li>
<li>The various, remaining attributes associated with each asset are stored in a JSON column (which might be named something like <tt class="docutils literal"><span class="pre">property_bag</span></tt>). For example, the JSON column for an office desk asset could include JSON data such as size, weight, and number of drawers. The JSON data for a server machine could include rack location, number of cores, and MAC address.</li>
</ul>
</div>
</div>
<div class="section" id="ddl-defining-tables-with-json-columns">
<span id="json-defining"></span><h2>DDL: Defining Tables with JSON Columns<a class="headerlink" href="index.html#ddl-defining-tables-with-json-columns" title="Permalink to this headline">¶</a></h2>
<p>Any MemSQL table can contain one or more columns of data type <tt class="docutils literal"><span class="pre">JSON</span></tt>. A JSON column can optionally be suffixed with <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></tt>. Using the <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></tt> suffix is recommended because it causes MemSQL to give an error if the user attempts to insert invalid JSON.</p>
<div class="section" id="comparing-json-and-longtext-columns">
<h3>Comparing JSON and LONGTEXT Columns<a class="headerlink" href="index.html#comparing-json-and-longtext-columns" title="Permalink to this headline">¶</a></h3>
<p>A JSON column is analogous to a <tt class="docutils literal"><span class="pre">LONGTEXT</span></tt> column in the following ways:</p>
<ul class="simple">
<li>JSON columns can store arbitrarily large JSON values in a normalized text representation.</li>
<li>JSON columns have the same storage requirement, as if the JSON value were stored in a text column.</li>
</ul>
<p>The key difference is that JSON data is stored in a <cite>normalized</cite> format, which makes many operations faster than if the data were stored manually in a text column. The following is an example of non-normalized data, which is valid JSON but is relatively difficult to parse:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="s1">&#39;{ &quot;b\u000a&quot;: 1,&quot;a&quot;: 2 ,&quot;a&quot;:3 } &#39;</span>
</pre></div>
</div>
<p>Normalized data, on the other hand, is easier to parse because duplicate keys are merged, keys are sorted by value, and extraneous whitespace is removed.</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="s1">&#39;{&quot;a&quot;:3,&quot;b\n&quot;:1}&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-json-columns">
<h3>Defining JSON Columns<a class="headerlink" href="index.html#defining-json-columns" title="Permalink to this headline">¶</a></h3>
<p>Defining a JSON column in a MemSQL table is as simple as specifying the <tt class="docutils literal"><span class="pre">JSON</span></tt> data type in the <a class="reference internal" href="../../ref/CREATE_TABLE/index.html"><em>CREATE TABLE</em></a> command:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">assets</span> <span class="p">(</span>
   <span class="n">tag_id</span> <span class="kt">BIGINT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
   <span class="n">name</span> <span class="kt">TEXT</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
   <span class="n">description</span> <span class="kt">TEXT</span><span class="p">,</span>
   <span class="n">properties</span> <span class="n">JSON</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended that users define JSON columns with the <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></tt> suffix. This way MemSQL gives an error if the user attempts to insert invalid JSON.</p>
</div>
</div>
<div class="section" id="indexing-data-in-json-columns">
<h3>Indexing Data in JSON Columns<a class="headerlink" href="index.html#indexing-data-in-json-columns" title="Permalink to this headline">¶</a></h3>
<p>JSON columns are not indexed directly&#8212;they are indexed using computed columns. For the fastest performance, you should not use JSON built-ins or <tt class="docutils literal"><span class="pre">::</span></tt> notation in your filters. Instead, create a <cite>computed</cite> column that includes the JSON column in the computation, and then use the computed column for the index. In this way, the index gets updated only when the relevant JSON data is updated in a row.</p>
<div class="highlight-mysql"><div class="highlight"><pre>CREATE TABLE assets (
   tag_id BIGINT PRIMARY KEY,
   name TEXT NOT NULL,
   description TEXT,
   properties JSON NOT NULL,
   weight AS properties::%weight PERSISTED DOUBLE,
   license_plate AS properties::$license_plate PERSISTED TEXT,
   KEY(license_plate), KEY(weight));
</pre></div>
</div>
<p>In this example, the following queries will be strictly more efficient:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">assets</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">weight</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">assets</span> <span class="k">WHERE</span> <span class="n">license_plate</span> <span class="o">=</span> <span class="s2">&quot;VGB116&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>than these equivalent queries:</p>
<div class="highlight-mysql"><div class="highlight"><pre>SELECT * FROM assets ORDER BY properties::%weight;
SELECT * FROM assets WHERE properties::$license_plate = &quot;VGB116&quot;;
</pre></div>
</div>
</div>
</div>
<div class="section" id="dml-accessing-data-in-json-columns">
<span id="accessing"></span><h2>DML: Accessing Data in JSON Columns<a class="headerlink" href="index.html#dml-accessing-data-in-json-columns" title="Permalink to this headline">¶</a></h2>
<p>This section describes how to insert and update data in a MemSQL table with one or more JSON columns.</p>
<div class="section" id="adding-data-to-a-json-column-upon-insert">
<h3>Adding Data to a JSON Column Upon INSERT<a class="headerlink" href="index.html#adding-data-to-a-json-column-upon-insert" title="Permalink to this headline">¶</a></h3>
<p>When inserting a row in a table, adding data to a JSON column is straightforward.</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">posts</span> <span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">usercomments</span><span class="p">)</span> <span class="k">VALUES</span>
    <span class="p">(</span><span class="s1">&#39;My first post!&#39;</span><span class="p">,</span> <span class="s1">&#39;[]&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Followup to first post&#39;</span><span class="p">,</span> <span class="s1">&#39;[]&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-fields-in-a-json-object">
<h3>Accessing Fields in a JSON Object<a class="headerlink" href="index.html#accessing-fields-in-a-json-object" title="Permalink to this headline">¶</a></h3>
<p>To access a field of a JSON object stored in a column, use the name of the column suffixed
with <tt class="docutils literal"><span class="pre">::keyName</span></tt>. For example, if column <tt class="docutils literal"><span class="pre">data</span></tt> contains <tt class="docutils literal"><span class="pre">{&quot;bits&quot;:[true,false]}</span></tt>, then
the expression <tt class="docutils literal"><span class="pre">data::bits</span></tt> evaluates to the JSON value <tt class="docutils literal"><span class="pre">[true,false]</span></tt>.</p>
<div class="section" id="converting-a-json-string-value-into-a-sql-string">
<h4>Converting a JSON String Value into a SQL String<a class="headerlink" href="index.html#converting-a-json-string-value-into-a-sql-string" title="Permalink to this headline">¶</a></h4>
<p>To transparently convert a JSON string value (enclosed in quotation marks and possibly containing escape sequences) into a SQL string, use the name of the column suffixed with <tt class="docutils literal"><span class="pre">::$keyname</span></tt>. For example, if the SQL string <tt class="docutils literal"><span class="pre">'{&quot;magic&quot;:&quot;hello\\nworld&quot;}'</span></tt> is inserted into column <tt class="docutils literal"><span class="pre">data</span></tt>, then:</p>
<ul class="simple">
<li>The expression <tt class="docutils literal"><span class="pre">data::magic</span></tt> evaluates to <tt class="docutils literal"><span class="pre">'&quot;hello\\nworld&quot;'</span></tt>. This a valid JSON entity, properly escaped and quoted, that can safely be reinserted into a JSON column.</li>
<li>The expression <tt class="docutils literal"><span class="pre">data::$magic</span></tt> evaluates to <tt class="docutils literal"><span class="pre">'hello\nworld'</span></tt>. This is a SQL string with an embedded newline.</li>
</ul>
<div class="highlight-mysql"><div class="highlight"><pre>SELECT uid, CONCAT(userdata::name::$first, &#39; &#39;, userdata::name::$last) FROM users;
</pre></div>
</div>
</div>
<div class="section" id="converting-a-json-number-or-boolean-value-into-a-sql-double">
<h4>Converting a JSON Number or Boolean Value into a SQL DOUBLE<a class="headerlink" href="index.html#converting-a-json-number-or-boolean-value-into-a-sql-double" title="Permalink to this headline">¶</a></h4>
<p>To transparently convert a JSON number or Boolean value into a SQL <tt class="docutils literal"><span class="pre">DOUBLE</span></tt>, use the name of the column suffixed with <tt class="docutils literal"><span class="pre">::%keyname</span></tt>. For example, if column <tt class="docutils literal"><span class="pre">data</span></tt> contains <tt class="docutils literal"><span class="pre">{&quot;valid&quot;:true,&quot;value&quot;:3.14}</span></tt>, then <tt class="docutils literal"><span class="pre">data::%valid</span></tt> is <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">data::%value</span></tt> is <tt class="docutils literal"><span class="pre">3.14</span></tt>.</p>
</div>
<div class="section" id="using-the-and-operators">
<h4>Using the ::$ and ::% Operators<a class="headerlink" href="index.html#using-the-and-operators" title="Permalink to this headline">¶</a></h4>
<p>If the <tt class="docutils literal"><span class="pre">::$</span></tt> or <tt class="docutils literal"><span class="pre">::%</span></tt> operator is used on a JSON field that is not of the appropriate type, the JSON result is quietly converted to string or double, following the rules described in <a class="reference internal" href="../../ref/functions/JSON_EXTRACT/index.html"><em>JSON_EXTRACT_&lt;type&gt;</em></a>. In fact, these access operators are simply convenient aliases for the <tt class="docutils literal"><span class="pre">JSON_EXTRACT_&lt;type&gt;</span></tt> built-in function, and they follow all the same rules.</p>
</div>
<div class="section" id="accessing-nested-json-objects">
<h4>Accessing Nested JSON Objects<a class="headerlink" href="index.html#accessing-nested-json-objects" title="Permalink to this headline">¶</a></h4>
<p>To access nested JSON objects, chain the colon-colon operator to form a <cite>keypath</cite>. For example, <tt class="docutils literal"><span class="pre">data::address::street</span></tt> means the <tt class="docutils literal"><span class="pre">street</span></tt> field of the <tt class="docutils literal"><span class="pre">address</span></tt> field of the <tt class="docutils literal"><span class="pre">data</span></tt> column.</p>
</div>
</div>
<div class="section" id="using-colon-colon-notation-in-update-queries">
<span id="updating"></span><h3>Using Colon-Colon Notation in UPDATE Queries<a class="headerlink" href="index.html#using-colon-colon-notation-in-update-queries" title="Permalink to this headline">¶</a></h3>
<p>You can use the colon-colon notation for JSON keypaths in <a class="reference internal" href="../../ref/UPDATE/index.html"><em>UPDATE</em></a> queries.
For example, the following two <tt class="docutils literal"><span class="pre">UPDATE</span></tt> queries perform exactly the same operation:</p>
<div class="highlight-mysql"><div class="highlight"><pre>UPDATE users SET userdata::name::$first = &#39;Alex&#39;;
UPDATE users SET userdata = JSON_SET_STRING(userdata, &#39;name&#39;, &#39;first&#39;, &#39;Alex&#39;);
</pre></div>
</div>
<p>In fact, these access operators are simply convenient aliases for the <tt class="docutils literal"><span class="pre">JSON_SET_&lt;type&gt;</span></tt> built-in function (see <a class="reference internal" href="../../ref/functions/JSON_SET/index.html"><em>JSON_SET_&lt;type&gt;</em></a>), and they follow all the same rules.</p>
</div>
<div class="section" id="field-name-syntax-for-json-access-and-update-queries">
<span id="updating-syntax"></span><h3>Field Name Syntax for JSON Access and UPDATE Queries<a class="headerlink" href="index.html#field-name-syntax-for-json-access-and-update-queries" title="Permalink to this headline">¶</a></h3>
<p>In both the JSON access and update contexts, each field name must either:</p>
<ul class="simple">
<li>follow the syntax for a valid SQL identifier, or</li>
<li>be escaped with backticks in the same manner as a SQL identifier</li>
</ul>
<p>For example, the following two <a class="reference internal" href="../../ref/SELECT/index.html"><em>SELECT</em></a> queries perform exactly the same operation:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="k">SELECT</span> <span class="n">ticker_symbol</span> <span class="k">FROM</span> <span class="n">stocks</span> <span class="k">WHERE</span> <span class="n">statistics</span><span class="p">::</span><span class="o">%</span><span class="ss">`P/E`</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="n">ticker_symbol</span> <span class="k">FROM</span> <span class="n">stocks</span> <span class="k">WHERE</span> <span class="nf">JSON_EXTRACT_DOUBLE</span><span class="p">(</span><span class="n">statistics</span><span class="p">,</span> <span class="s1">&#39;P/E&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">.</span><span class="mi">5</span><span class="p">;</span>
</pre></div>
</div>
<p>When using the <tt class="docutils literal"><span class="pre">JSON_EXTRACT_&lt;type&gt;</span></tt> form of the query (see <a class="reference internal" href="../../ref/functions/JSON_EXTRACT/index.html"><em>JSON_EXTRACT_&lt;type&gt;</em></a>), there is no constraint on the contents of the keystring. A JSON object can contain any string as a key, even <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt>, or a string with <tt class="docutils literal"><span class="pre">&quot;embedded\u0000nulls&quot;</span></tt>.</p>
</div>
</div>
<div class="section" id="implementation-considerations">
<span id="considerations"></span><h2>Implementation Considerations<a class="headerlink" href="index.html#implementation-considerations" title="Permalink to this headline">¶</a></h2>
<p>This section describes some unique behaviors in MemSQL&#8217;s implementation of the JSON standard (RFC 4627).</p>
<div class="section" id="infinities-and-nans">
<span id="considerations-nan"></span><h3>Infinities and NaNs<a class="headerlink" href="index.html#infinities-and-nans" title="Permalink to this headline">¶</a></h3>
<p>MemSQL does not attempt to support entities such as the <tt class="docutils literal"><span class="pre">nan</span></tt> (&#8220;not a number&#8221;) entity, as in <tt class="docutils literal"><span class="pre">{&quot;value&quot;:nan}</span></tt>. Although the JavaScript language supports <tt class="docutils literal"><span class="pre">nan</span></tt> and positive and negative infinities, neither the JSON standard nor SQL&#8217;s <tt class="docutils literal"><span class="pre">DOUBLE</span></tt> type provide any way to represent such non-finite values. If your application requires these special values, you might try using <tt class="docutils literal"><span class="pre">null</span></tt>, <tt class="docutils literal"><span class="pre">0.0</span></tt>, or strings (such as <tt class="docutils literal"><span class="pre">&quot;nan&quot;</span></tt> and <tt class="docutils literal"><span class="pre">&quot;inf&quot;</span></tt>) in their place.</p>
</div>
<div class="section" id="unicode-support">
<span id="considerations-unicode"></span><h3>Unicode Support<a class="headerlink" href="index.html#unicode-support" title="Permalink to this headline">¶</a></h3>
<p>JSON strings can contain any of the 65536 Unicode characters in the Basic Multilingual Plane,
either directly as themselves or escaped with JSON&#8217;s <tt class="docutils literal"><span class="pre">\uABCD</span></tt> notation. JSON normalization
converts all such ASCII escape sequences into UTF-8 byte sequences, except for those characters
that must remain <tt class="docutils literal"><span class="pre">\u</span></tt>-encoded in order to keep the string valid JSON.</p>
<p>MemSQL (like MySQL) does not support characters outside the Basic Multilingual Plane (characters whose codepoints are in the range 0xFFFF to 0x10FFFF). This includes some uncommon
Chinese characters, and symbols such as emoji. Attempts to insert or use JSON entities containing those characters are rejected, which, in MemSQL, causes those entities to become SQL <tt class="docutils literal"><span class="pre">NULL</span></tt> instead. Such characters can be unambiguously encoded using JSON&#8217;s surrogate pair notation:</p>
<div class="highlight-mysql"><div class="highlight"><pre><span class="c1">-- Here, &quot;:)&quot; stands in for the four-byte Unicode character U+1F602</span>
<span class="k">UPDATE</span> <span class="n">posts</span> <span class="kt">SET</span> <span class="n">usercomments</span> <span class="o">=</span> <span class="nf">JSON_ARRAY_PUSH_JSON</span><span class="p">(</span><span class="n">usercomments</span><span class="p">,</span> <span class="s1">&#39;&quot;Nice post! :)&quot;&#39;</span><span class="p">);</span>  <span class="c1">-- pushes JSON &#39;null&#39; instead</span>
<span class="k">UPDATE</span> <span class="n">posts</span> <span class="kt">SET</span> <span class="n">usercomments</span> <span class="o">=</span> <span class="nf">JSON_ARRAY_PUSH_JSON</span><span class="p">(</span><span class="n">usercomments</span><span class="p">,</span> <span class="s1">&#39;&quot;Nice post! \\uD83D\\uDE02&quot;&#39;</span><span class="p">);</span>  <span class="c1">-- succeeds</span>
<span class="k">SELECT</span> <span class="n">usercomments</span> <span class="k">FROM</span> <span class="n">posts</span><span class="p">;</span>
</pre></div>
</div>
<p>However, if your front-end encodes high Unicode characters in this way, it must also be prepared to deal with the UTF-8-encoded surrogate pairs returned in queries. For example, the <tt class="docutils literal"><span class="pre">SELECT</span></tt> query above will return a string of the form <tt class="docutils literal"><span class="pre">[null,&quot;Nice</span> <span class="pre">post!</span> <span class="pre">HhhLll&quot;]</span></tt>, where <tt class="docutils literal"><span class="pre">HhhLll</span></tt> represents a high surrogate and low surrogate encoded as invalid UTF-8.</p>
</div>
<div class="section" id="character-encodings-and-collation">
<span id="considerations-collation"></span><h3>Character Encodings and Collation<a class="headerlink" href="index.html#character-encodings-and-collation" title="Permalink to this headline">¶</a></h3>
<p><cite>Collation</cite> provides a set of rules to use when comparing characters in a character set. By default, JSON columns in MemSQL tables use the <tt class="docutils literal"><span class="pre">utf8_bin</span></tt> collation, which is a case-sensitive collation that sorts by Unicode codepoint value. The collation of a JSON column affects the following:</p>
<ul class="simple">
<li>Output of <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">DISTINCT</span></tt>, <tt class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></tt>, and other queries that compare entire values.</li>
<li>Identification of duplicate keys inside a single JSON object during normalization. Example: Whether the string <tt class="docutils literal"><span class="pre">{&quot;Schlüssel&quot;:1,&quot;Schluessel&quot;:2}</span></tt> is normalized to <tt class="docutils literal"><span class="pre">{&quot;Schluessel&quot;:2}</span></tt>.</li>
<li>Sorting of keys inside a single JSON object. Example: Whether the string <tt class="docutils literal"><span class="pre">{&quot;Schlüssel&quot;:1,&quot;Schluff&quot;:2}</span></tt> is normalized to <tt class="docutils literal"><span class="pre">{&quot;Schluff&quot;:2,&quot;Schlüssel&quot;:1}</span></tt>.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">utf8_bin</span></tt> collation generally provides the desired behavior. However, you can override this default at the table or column level.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MemSQL recommends that you use the <tt class="docutils literal"><span class="pre">utf8_bin</span></tt> collation for all JSON columns&#8212;either implicitly by default, or explicitly at the column level.</p>
</div>
<p><strong>Table-level Override</strong></p>
<p>In the following example, for the <tt class="docutils literal"><span class="pre">users</span></tt> table, both <tt class="docutils literal"><span class="pre">userdata</span></tt> and <tt class="docutils literal"><span class="pre">lastname</span></tt> use the table collation (which has been specified as <tt class="docutils literal"><span class="pre">utf8_unicode_ci</span></tt>).</p>
<div class="highlight-mysql"><div class="highlight"><pre>CREATE TABLE users (
    uid INT AUTO_INCREMENT PRIMARY KEY,
    userdata JSON,
    lastname AS data::name::$last PERSISTED TEXT) COLLATE=utf8_unicode_ci;
</pre></div>
</div>
<p><strong>Column-level Override</strong></p>
<p>In the following example, for the <tt class="docutils literal"><span class="pre">orders</span></tt> table:</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">data</span></tt> column uses <tt class="docutils literal"><span class="pre">utf8_unicode_ci</span></tt>.</li>
<li>The <tt class="docutils literal"><span class="pre">productdetails</span></tt> column uses <tt class="docutils literal"><span class="pre">utf8_bin</span></tt>.</li>
<li>Both the <tt class="docutils literal"><span class="pre">productname</span></tt> column and the <tt class="docutils literal"><span class="pre">comments</span></tt> column use <tt class="docutils literal"><span class="pre">utf8_general_ci</span></tt>, which is MemSQL&#8217;s default database collation</li>
</ul>
<div class="highlight-mysql"><div class="highlight"><pre>CREATE TABLE orders (
    oid INT AUTO_INCREMENT PRIMARY KEY,
    data JSON COLLATE utf8_unicode_ci,
    productname AS data::product::$name PERSISTED TEXT,
    productdetails AS data::product::$details PERSISTED TEXT COLLATE utf8_bin,
    comments VARCHAR(256));
</pre></div>
</div>
</div>
<div class="section" id="maximum-json-value-size">
<h3>Maximum JSON Value Size<a class="headerlink" href="index.html#maximum-json-value-size" title="Permalink to this headline">¶</a></h3>
<p>Under the hood, JSON data is stored in <tt class="docutils literal"><span class="pre">LONGBLOB</span></tt> columns. As a practical matter, the size limit of a JSON
value is bounded by the <tt class="docutils literal"><span class="pre">max-allowed-packet</span></tt> variable.</p>
</div>
</div>
</div>


                    </div>
                    <footer data-swiftype-index="false">
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../admin/index.html" class="btn btn-neutral float-right" title="Operations Manual">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../../concepts/geospatial/index.html" class="btn btn-neutral" title="Geospatial Guide"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>&copy; Copyright 2015, MemSQL</p>
  </div>
</footer>
                </div>
            </div>

        </section>
    </div>

    <script type="text/javascript" src="../../../static_star_theme/js/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="../../../static_star_theme/js/underscore-min.js"></script>
    <script type="text/javascript" src="../../../static_star_theme/js/jquery.ba-hashchange.min.js"></script>
    <script type="text/javascript" src="../../../static_star_theme/js/jquery.swiftype.search.js"></script>
    <script type="text/javascript" src="../../../static_star_theme/js/jquery.swiftype.autocomplete.js"></script>
    <script type="text/javascript" src="../../../static_star_theme/js/theme.js"></script>
    <script type="text/javascript" src="../../../static_star_theme/js/search.js"></script> 

        <!-- Google Analytics -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-21693588-3', 'auto');
            ga('send', 'pageview');
        </script>
        <!-- End Google Analytics -->

        <script type="text/javascript">
            $.ajax({
                url: document.location.protocol + '//munchkin.marketo.net/munchkin.js',
                dataType: 'script',
                cache: true,
                success: function() {
                    Munchkin.init('759-YLI-316');
                }
            });
        </script>
    </body>
</html>